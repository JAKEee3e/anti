-- Main script to initialize and run all functionalities

local CoreGui = game:GetService("CoreGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Anti exploitation check
if not game:IsLoaded() then 
    game.Loaded:Wait()
end

-- Create a notification function
local function notify(text, duration)
    duration = duration or 5
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Script Loader",
        Text = text,
        Duration = duration
    })
end

-- Main loading function
local function loadScripts()
    notify("Starting script initialization...")
    
    -- Load the loader script
    local success, Loader = pcall(function()
        -- Try to require loader from ReplicatedStorage first
        local loaderModule = ReplicatedStorage:WaitForChild("DownloadedScripts"):WaitForChild("loader")
        return require(loaderModule)
    end)
    
    if not success then
        warn("Failed to load loader script:", Loader)
        notify("Failed to initialize loader", 10)
        return
    end
    
    -- Initialize the loader
    success = Loader:Initialize()
    
    if success then
        notify("Successfully loaded all scripts!", 5)
        
        -- Access loaded scripts if needed
        local loadedScripts = Loader:GetLoadedScripts()
        if loadedScripts.gui then
            print("GUI module loaded successfully")
        end
    else
        notify("Failed to load some scripts. Check console for details.", 10)
    end
end

-- Run the loader
loadScripts()

-- Require the GUI to access toggle states
local toggles = require(game:GetService("CoreGui"):WaitForChild("ToggleGUI"))

-- Require each functionality script
local aimbot = require(script.Parent:WaitForChild("Aimbot"))
local esp = require(script.Parent:WaitForChild("esP"))
local antiFlash = require(script.Parent:WaitForChild("anti-flash"))
local radar = require(script.Parent:WaitForChild("radar"))
local skeletonESP = require(script.Parent:WaitForChild("skeleton-esp"))

-- Function to initialize all functionalities
local function initializeAll()
    -- Aimbot
    if toggles.aimbot then
        aimbot.initialize()
    end

    -- ESP
    if toggles.esp then
        esp.initialize()
    end

    -- Anti-Flash
    if toggles.antiFlash then
        antiFlash.initialize()
    end

    -- Radar
    if toggles.radar then
        radar.initialize()
    end

    -- Skeleton ESP
    if toggles.skeletonESP then
        skeletonESP.initialize()
    end
end

-- Initialize all functionalities
initializeAll()

-- Listen for toggle changes
toggles.Changed:Connect(function()
    initializeAll()
end)

BaseURL = "https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main"
